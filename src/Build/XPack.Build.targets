<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">
	<UsingTask TaskName="XPack.Build.Tasks.ResolveAssemblyReferences"
			   AssemblyFile="$(MSBuildThisFileDirectory)\XPack.Build.dll"/>

  <Target Name="BeforeResolveReferences" DependsOnTargets="_OverrideHintPaths">
    
  </Target>

  <Target Name="AfterResolveReferences">
    <!--Message Text="References after: %(Reference.HintPath)"/-->
    <Message Text="ReferencePath: @(ReferencePath)"/>
  </Target>

  <Target Name="_OverrideHintPaths" Condition="$(TestAssemblyName)!='' and $(TestAssemblyDirectory)!=''">
    <XPack.Build.Tasks.ResolveAssemblyReferences AssemblyReferences="@(Reference)"
        TestAssemblyName="$(TestAssemblyName)"
        TestAssemblyDirectory="$(TestAssemblyDirectory)"
        Enabled="true"
        DebugTask="false">
      <Output TaskParameter="AssemblyMetadataOverrides" ItemName="AssemblyMetadataOverride"/>
    </XPack.Build.Tasks.ResolveAssemblyReferences>
    <ItemGroup>
      <Reference Remove="%(AssemblyMetadataOverride.Identity)"/>
      <Reference Include="%(AssemblyMetadataOverride.Identity)">
        <HintPath>%(AssemblyMetadataOverride.HintPath)</HintPath>
      </Reference>
    </ItemGroup>
  </Target>
  
</Project>