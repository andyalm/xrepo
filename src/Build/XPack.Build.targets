<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="4.0">
	<UsingTask TaskName="XPack.Build.Tasks.ResolveAssemblyReferences"
			   AssemblyFile="$(MSBuildThisFileDirectory)\XPack.Build.dll"/>

  <PropertyGroup>
    <ResolveReferencesDependsOn>
      _OverrideHintPaths;
      $(ResolveReferencesDependsOn)
    </ResolveReferencesDependsOn>
  </PropertyGroup>

  <Target Name="_OverrideHintPaths" Condition="$(TestAssemblyName)!='' and $(TestAssemblyDirectory)!=''">
    <XPack.Build.Tasks.ResolveAssemblyReferences
        AssemblyReferences="@(Reference)"
        TestAssemblyName="$(TestAssemblyName)"
        TestAssemblyDirectory="$(TestAssemblyDirectory)"
        Enabled="true"
        DebugTask="false">
      <Output TaskParameter="AssemblyReferenceOverrides" ItemName="ReferenceOverride"/>
    </XPack.Build.Tasks.ResolveAssemblyReferences>
    <ItemGroup>
      <Reference Remove="%(ReferenceOverride.Identity)"/>
      <Reference Include="@(ReferenceOverride)" />
    </ItemGroup>
    <Message Text="%(ReferenceOverride.ShortName) reference overridden by xpack. Using '%(ReferenceOverride.HintPath)'" Condition="@(ReferenceOverride)!=''"/>
  </Target>
  
</Project>